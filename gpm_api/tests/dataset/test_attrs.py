from gpm_api.dataset import attrs


def test_decode_string() -> None:
    # Try string including keys (separated by '='). Dataset: 1A GMI
    string = "InputFileNames=GPM.GMIS.20150801.131141073_20150801.131639202.001.SCANRAW\nGPM.GMIS.20150801.131641077_20150801.132139205.001.SCANRAW\nGPM.GMIS.20150801.132141080_20150801.132639209.001.SCANRAW\nGPM.GMIS.20150801.132641084_20150801.133139212.001.SCANRAW\nGPM.GMIS.20150801.133141087_20150801.133639216.001.SCANRAW\nGPM.GMIS.20150801.133641091_20150801.134139219.001.SCANRAW\nGPM.GMIS.20150801.134141094_20150801.134639223.001.SCANRAW\nGPM.GMIS.20150801.134641098_20150801.135139226.001.SCANRAW\nGPM.GMIS.20150801.135141101_20150801.135639230.001.SCANRAW\nGPM.GMIS.20150801.135641105_20150801.140139233.001.SCANRAW\nGPM.GMIS.20150801.140141108_20150801.140639237.001.SCANRAW\nGPM.GMIS.20150801.140641112_20150801.141139240.001.SCANRAW\nGPM.GMIS.20150801.141141115_20150801.141639244.001.SCANRAW\nGPM.GMIS.20150801.141641119_20150801.142139247.001.SCANRAW\nGPM.GMIS.20150801.142141122_20150801.142639251.001.SCANRAW\nGPM.GMIS.20150801.142641126_20150801.143139254.001.SCANRAW\nGPM.GMIS.20150801.143141129_20150801.143639258.001.SCANRAW\nGPM.GMIS.20150801.143641133_20150801.144139261.001.SCANRAW\nGPM.GMIS.20150801.144141136_20150801.144639265.001.SCANRAW\nGPM.GMIS.20150801.144641140_20150801.145139268.001.SCANRAW;\nInputAlgorithmVersions=n/a;\nInputGenerationDateTimes=n/a;\n"

    res = attrs.decode_string(string)

    assert isinstance(res, dict), "String not returned as dictionary"
    assert list(res.keys()) == [
        "InputFileNames",
        "InputAlgorithmVersions",
        "InputGenerationDateTimes",
    ]

    for key, props in res.items():
        assert "\t" not in props, "Tab not removed"
        assert "\n" not in props, "New line not removed"
        assert ";" not in props, "Semicolon not removed"

    # Try without = separator
    string = "2016067040550_52442_CS_2B-GEOPROF_GRANULE_P1_R05_E06_F00.hdf"
    res = attrs.decode_string(string)

    assert isinstance(res, str), "String not returned as string"
    assert res == string, "String altered when should be returned as is"
